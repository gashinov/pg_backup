# pg_backup
Automate PostgreSQL backup


Скрипт автоматизации резервного копирования баз 1С с помощью утилиты pg_dump. Решает проблему резервирования нестандартных конфигураций с превышением размера строки возможностям stdout PostgreSQL сервера: "invalid memory alloc request size". Аналогично можно резервировать другие "дутые" таблицы, если нет возможности их исправить.


Выполнение копирования не требует отключения клиентов, но обязательно отсутствие блокировки таблицы конфигурации Конфигуратором.


Структура файлов:
```
/путь/к/скриптам/
├── pg_dump.sh      # основной скрипт
├── pg_dump.lib     # библиотека с переменными и функциями
├── pg_dump.conf    # список баз для автоматического бэкапа
```

Установить исполнение планировщиком задач по таймеру. Прописать свои переменные для выполнения резервного копирования баз, перечисленных в файле pg_dump.lib.


Запуск без параметров — резервное копирование баз из pg_dump.conf

```
Ключи запуска:
--manual — выбор базы по индексу из отсортированного списка
--version — вывод версии скрипта
--help — справка
```


Формат копии - directory. Параллелизм устанавливается переменной PGJOBS.


Раздельное хранение автоматических и ручных копий.
```
BACKUP_DIRECTORY_AUTO="/netbackup"
BACKUP_DIRECTORY_MANUAL="/netbackup/_manual"
```


Можно запускать с Windows 10+ хоста через bat файл командой 
```
ssh username@pg-host -t "/opt/scripts/pg_tools/pg_dump.sh --manual; bash -l $$ ~."
pause
```
